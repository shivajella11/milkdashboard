<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/farm.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<style>
  
/* Improved Banner Styles */
.banner {
  background: linear-gradient(135deg, #4a6fa5, #166088);
    color: white;
    padding: 6px 16px; /* Reduced vertical padding for less height */
    border-radius: 12px; /* Adjusted rounded corners */
    margin: 0 0 20px 0;
    width: 100%;
    height: 80px;
    border-bottom: 4px solid #3a5f8a;
}

.banner-content h2 {
  margin: 0;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.banner-content p {
  margin: 0.5rem 0 0;
  opacity: 0.9;
  font-size: 0.9rem;
}

.banner-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.banner-btn {
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s;
  font-weight: 500;
  margin-top: 10px;
}

.banner-btn.primary {
  background: #74d3e9;
  color: #0d47a1
}

.banner-btn.primary:hover {
  background: rgba(255,255,255,0.9);
  transform: translateY(-1px);
}

/* Modal Form Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  overflow: auto;
}

.modal-content {
  background: white;
  margin: 5% auto;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  width: 80%;
  max-width: 600px;
  animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
  from {opacity: 0; transform: translateY(-20px);}
  to {opacity: 1; transform: translateY(0);}
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #eee;
  padding-bottom: 15px;
  margin-bottom: 20px;
}

.modal-header h3 {
  margin: 0;
  color: #166088;
  display: flex;
  align-items: center;
  gap: 10px;
}

.close-modal {
  font-size: 24px;
  cursor: pointer;
  color: #999;
  transition: color 0.2s;
}

.close-modal:hover {
  color: #333;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #444;
}

.form-group input, .form-group select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.form-group input:focus, .form-group select:focus {
  border-color: #4a6fa5;
  outline: none;
  box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 30px;
}

.form-btn {
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
  border: none;
  transition: all 0.2s;
}

.form-btn.cancel {
  background: #f1f1f1;
  color: #666;
}

.form-btn.submit {
  background: #4a6fa5;
  color: white;
}

.form-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.form-btn.cancel:hover {
  background: #e5e5e5;
}

.form-btn.submit:hover {
  background: #3a5f8a;
}

/* Chilling Status Indicators */
.chilling-status {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  text-align: center;
  margin-top: 5px;
  width: 100%;
  transition: all 0.3s ease;
}

.chilling-status-normal {
  background-color: #e8f5e9;
  color: #2e7d32;
}

.chilling-status-low {
  background-color: #fff8e1;
  color: #f57f17;
}

.chilling-status-full {
  background-color: #ffebee;
  color: #c62828;
}

.chilling-action-btn {
  background: none;
  border: none;
  color: #4a6fa5;
  cursor: pointer;
  font-size: 1rem;
  margin: 0 3px;
  padding: 5px;
  transition: all 0.2s;
}

.chilling-action-btn:hover {
  color: #166088;
  transform: scale(1.2);
}

.chilling-action-btn.delete-btn:hover {
  color: #d32f2f;
}

/* Temperature Display */
.temperature-display {
  background-color: #e3f2fd;
  color: #0d47a1;
  padding: 10px;
  border-radius: 4px;
  text-align: center;
  font-weight: 500;
  margin-top: 5px;
  border: 1px solid #bbdefb;
}

.text-primary {
  color: #0d47a1;
}

.text-danger {
  color: #c62828;
}

/* Milk Flow Cards Styles */
.milk-flow-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-bottom: 40px;
}

.milk-flow-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 20px;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.milk-flow-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.milk-flow-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 6px;
  background: linear-gradient(90deg, #4a6fa5, #74d3e9);
}

.milk-flow-card.intake::before {
  background: linear-gradient(90deg, #4CAF50, #8BC34A);
}

.milk-flow-card.outtake::before {
  background: linear-gradient(90deg, #FF9800, #FFEB3B);
}

.milk-flow-card.processing::before {
  background: linear-gradient(90deg, #2196F3, #03A9F4);
}

.milk-flow-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.milk-flow-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: #333;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.milk-flow-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  color: white;
}

.milk-flow-icon.intake {
  background: linear-gradient(135deg, #4CAF50, #8BC34A);
}

.milk-flow-icon.outtake {
  background: linear-gradient(135deg, #FF9800, #FFEB3B);
}

.milk-flow-icon.processing {
  background: linear-gradient(135deg, #2196F3, #03A9F4);
}

.milk-flow-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 15px;
}

.milk-flow-stat {
  background: #f9f9f9;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}

.milk-flow-stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #333;
  margin: 0 0 5px 0;
}

.milk-flow-stat-label {
  font-size: 0.85rem;
  color: #666;
  margin: 0;
}

.milk-flow-chart {
  height: 120px;
  margin-top: 15px;
  background: #f9f9f9;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.chart-bars {
  display: flex;
  align-items: flex-end;
  height: 80px;
  width: 100%;
  padding: 0 20px;
  justify-content: space-around;
}

.chart-bar {
  width: 12px;
  background: #ddd;
  border-radius: 4px 4px 0 0;
  position: relative;
}

.chart-bar::after {
  content: attr(data-value);
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.7rem;
  color: #666;
}

.chart-bar.intake {
  background: linear-gradient(to top, #4CAF50, #8BC34A);
}

.chart-bar.outtake {
  background: linear-gradient(to top, #FF9800, #FFEB3B);
}

.chart-bar.processing {
  background: linear-gradient(to top, #2196F3, #03A9F4);
}

.milk-flow-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.milk-flow-trend {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.9rem;
}

.trend-up {
  color: #4CAF50;
}

.trend-down {
  color: #F44336;
}

.milk-flow-actions {
  display: flex;
  gap: 10px;
}

.milk-flow-btn {
  background: none;
  border: none;
  color: #4a6fa5;
  cursor: pointer;
  font-size: 1rem;
  padding: 5px;
  transition: all 0.2s;
}

.milk-flow-btn:hover {
  color: #166088;
  transform: scale(1.2);
}
</style>
<body>
  <nav class="navbar">
    <div class="nav-left">
        <img src="img/Company logo.jpg" class="logo" alt="Logo" />
        <div class="menu-title-group">
            <i class="fas fa-bars menu-icon" id="menuToggle"></i> 
        </div>
    </div>
    <div class="nav-center">
        <!-- Language Selector with Globe Icon -->
        <div class="nav-search-profile">
            <input type="text" placeholder="Search..." />
            
        </div>
        <!-- Can add navigation links here if needed -->
    </div>
    <div class="nav-right">
        <div class="nav-tools">
            <!-- Online Status Label -->
            <div class="status-label">
                <span id="statusDot" class="dot online"></span>
                <span id="statusText">Active</span>
            </div>
            <!-- Mode Toggle -->
            <button id="modeToggle" class="mode-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
        
        <div class="select-wrapper">
            <i class="fas fa-globe"></i>
            <select id="languageSelect" class="lang-dropdown">
                <option value="en">English</option>
                <option value="hi">हिन्दी</option>
                <option value="te">తెలుగు</option>
            </select>
        </div>
        <div class="nav-icons">
                <i class="fas fa-envelope"></i>
                <i class="fas fa-bell"></i>
            </div>
            <div class="profile">
                <img src="img/profile.jpg" alt="Profile" />
                <span>SHIVAKUMAR JELLA</span>
            </div>
    </div>
  </nav>
  <aside id="sidebar">
    <ul>
        <li class="dashboard-nav"><a href="dashb.html"><i class="fas fa-home"></i> Dashboard</a></li>
        <li class="farmer-nav"><a href="farmer.html"><i class="fas fa-user-friends"></i> Farmer Directory</a></li>
        <li class="collection-nav"><a href="collection.html"><i class="fas fa-tractor"></i> Daily Milk Yields</a></li>
        <li class="chilling-nav"><a href="chilling.html"><i class="fas fa-snowflake"></i> Cooling Stations</a></li>
        <li class="processing-nav"><a href="plant.html"><i class="fas fa-industry"></i> Dairy Processing</a></li>
        <li class="quality-nav"><a href="qualitydemo.html"><i class="fas fa-clipboard-check"></i> Milk Quality Tests</a></li>
        <li class="inventory-nav"><a href="product.html"><i class="fas fa-boxes"></i> Dairy Stockroom</a></li>
        <li class="logistics-nav"><a href="distubtion.html"><i class="fas fa-shipping-fast"></i> Farm-to-Market Routes</a></li>        
        <li class="crm-nav"><a href="crmdemo.html"><i class="fas fa-users"></i> CRM System</a></li>
    </ul>
  </aside>
  <main>
      <div class="chilling-container">
        <header class="chilling-header">
          <div class="banner">
            <div class="banner-content">
              <h2><i class="fas fa-snowflake"></i> Chilling Centers Management</h2>
              <p>Monitor and manage all milk chilling centers across the dairy farm network</p>
            </div>
            <div class="banner-actions">
              <button class="banner-btn primary" id="addCenterBtn">
                <i class="fas fa-plus"></i> Add New Center
              </button>
            </div>
          </div>
        </header>
        
        <!-- Add Center Modal Form -->
        <div id="addCenterModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3><i class="fas fa-snowflake"></i> Add New Chilling Center</h3>
              <span class="close-modal" id="closeModal">&times;</span>
            </div>
            <form id="addCenterForm">
              <div class="form-group">
                <label for="centerName">Center Name*</label>
                <input type="text" id="centerName" name="centerName" required placeholder="Enter center name">
              </div>
              <div class="form-group">
                <label for="centerLocation">Location*</label>
                <input type="text" id="centerLocation" name="centerLocation" required placeholder="Enter location">
              </div>
              <div class="form-group">
                <label for="centerCapacity">Capacity (Liters)*</label>
                <input type="number" id="centerCapacity" name="centerCapacity" required min="100" placeholder="Enter capacity in liters">
              </div>
              <div class="form-group">
                <label for="currentVolume">Current Volume (Liters)</label>
                <input type="number" id="currentVolume" name="currentVolume" min="0" placeholder="Enter current volume in liters">
              </div>
              <div class="form-group">
                <label for="temperature">Temperature (°C)</label>
                <div id="temperatureDisplay" class="temperature-display">3.5°C <i class="fas fa-temperature-low text-primary"></i></div>
                <input type="hidden" id="temperature" name="temperature" value="3.5">
              </div>
              <div class="form-group">
                <label for="storageStatus">Storage Status</label>
                <div id="storageStatusDisplay" class="chilling-status chilling-status-normal">Normal</div>
                <input type="hidden" id="storageStatus" name="storageStatus" value="normal">
              </div>
              <div class="form-actions">
                <button type="button" class="form-btn cancel" id="cancelForm">Cancel</button>
                <button type="submit" class="form-btn submit">Add Center</button>
              </div>
            </form>
          </div>
        </div>
      
        <div class="chilling-stats-container">
          <div class="chilling-stat-card">
            <h3 class="chilling-stat-title">Total Centers</h3>
            <p class="chilling-stat-value" id="total-centers">12</p>
          </div>
          <div class="chilling-stat-card">
            <h3 class="chilling-stat-title">Total Capacity</h3>
            <p class="chilling-stat-value">25,000 L</p>
          </div>
          <div class="chilling-stat-card">
            <h3 class="chilling-stat-title">Current Storage</h3>
            <p class="chilling-stat-value">18,750 L</p>
          </div>
          <div class="chilling-stat-card">
            <h3 class="chilling-stat-title">Utilization</h3>
            <p class="chilling-stat-value">75%</p>
          </div>
        </div>
      
        <table class="chilling-table">
          <thead>
            <tr>
              <th>Center Name</th>
              <th>Location</th>
              <th>Capacity (L)</th>
              <th>Current Volume</th>
              <th>Temperature</th>
              <th>Storage Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="center-table-body">
            <!-- Data will be injected here -->
          </tbody>
        </table>
        
        <div style="margin: 40px 0; border-top: 1px solid #e0e0e0; padding-top: 30px;">
          <h3 style="margin-bottom: 20px; color: #166088; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-chart-line"></i> Milk Flow Analytics
          </h3>
          
        
        <!-- Milk Flow Cards Section -->
        <div class="milk-flow-cards">
          <!-- Milk Intake Card -->
          <div class="milk-flow-card intake">
            <div class="milk-flow-header">
              <h3 class="milk-flow-title">
                <div class="milk-flow-icon intake">
                  <i class="fas fa-sign-in-alt"></i>
                </div>
                Milk Intake
              </h3>
              <span id="intakeDate">Today</span>
            </div>
            <p>Daily milk collection from farmers to chilling centers</p>
            
            <div class="milk-flow-stats">
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="todayIntakeValue">8,750 L</p>
                <p class="milk-flow-stat-label">Today's Intake</p>
              </div>
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="avgIntakeValue">9,200 L</p>
                <p class="milk-flow-stat-label">Weekly Average</p>
              </div>
            </div>
            
            <div class="milk-flow-chart">
              <div class="chart-bars">
                <div class="chart-bar intake" style="height: 40%;" data-value="Mon"></div>
                <div class="chart-bar intake" style="height: 65%;" data-value="Tue"></div>
                <div class="chart-bar intake" style="height: 80%;" data-value="Wed"></div>
                <div class="chart-bar intake" style="height: 55%;" data-value="Thu"></div>
                <div class="chart-bar intake" style="height: 70%;" data-value="Fri"></div>
                <div class="chart-bar intake" style="height: 60%;" data-value="Sat"></div>
                <div class="chart-bar intake" style="height: 50%;" data-value="Sun"></div>
              </div>
            </div>
            
            <div class="milk-flow-footer">
              <div class="milk-flow-trend">
                <i class="fas fa-arrow-down trend-down"></i>
                <span>5% from last week</span>
              </div>
              <!-- Milk flow actions removed as requested -->
            </div>
          </div>
          
          <!-- Milk Outtake Card -->
          <div class="milk-flow-card outtake">
            <div class="milk-flow-header">
              <h3 class="milk-flow-title">
                <div class="milk-flow-icon outtake">
                  <i class="fas fa-sign-out-alt"></i>
                </div>
                Milk Outtake
              </h3>
              <span id="outtakeDate">Today</span>
            </div>
            <p>Milk dispatched from chilling centers to processing plants</p>
            
            <div class="milk-flow-stats">
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="todayOuttakeValue">7,200 L</p>
                <p class="milk-flow-stat-label">Today's Outtake</p>
              </div>
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="avgOuttakeValue">8,100 L</p>
                <p class="milk-flow-stat-label">Weekly Average</p>
              </div>
            </div>
            
            <div class="milk-flow-chart">
              <div class="chart-bars">
                <div class="chart-bar outtake" style="height: 35%;" data-value="Mon"></div>
                <div class="chart-bar outtake" style="height: 60%;" data-value="Tue"></div>
                <div class="chart-bar outtake" style="height: 75%;" data-value="Wed"></div>
                <div class="chart-bar outtake" style="height: 50%;" data-value="Thu"></div>
                <div class="chart-bar outtake" style="height: 65%;" data-value="Fri"></div>
                <div class="chart-bar outtake" style="height: 55%;" data-value="Sat"></div>
                <div class="chart-bar outtake" style="height: 45%;" data-value="Sun"></div>
              </div>
            </div>
            
            <div class="milk-flow-footer">
              <div class="milk-flow-trend">
                <i class="fas fa-arrow-up trend-up"></i>
                <span>3% from last week</span>
              </div>
              <!-- Milk flow actions removed as requested -->
            </div>
          </div>
          
          <!-- Milk Processing Card -->
          <div class="milk-flow-card processing">
            <div class="milk-flow-header">
              <h3 class="milk-flow-title">
                <div class="milk-flow-icon processing">
                  <i class="fas fa-cogs"></i>
                </div>
                Milk Processing
              </h3>
              <span id="processingDate">Today</span>
            </div>
            <p>Milk processing status and quality control metrics</p>
            
            <div class="milk-flow-stats">
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="processingCapacityValue">85%</p>
                <p class="milk-flow-stat-label">Processing Capacity</p>
              </div>
              <div class="milk-flow-stat">
                <p class="milk-flow-stat-value" id="qualityPassValue">98.5%</p>
                <p class="milk-flow-stat-label">Quality Pass Rate</p>
              </div>
            </div>
            
            <div class="milk-flow-chart">
              <div class="chart-bars">
                <div class="chart-bar processing" style="height: 70%;" data-value="Mon"></div>
                <div class="chart-bar processing" style="height: 85%;" data-value="Tue"></div>
                <div class="chart-bar processing" style="height: 90%;" data-value="Wed"></div>
                <div class="chart-bar processing" style="height: 75%;" data-value="Thu"></div>
                <div class="chart-bar processing" style="height: 80%;" data-value="Fri"></div>
                <div class="chart-bar processing" style="height: 85%;" data-value="Sat"></div>
                <div class="chart-bar processing" style="height: 65%;" data-value="Sun"></div>
              </div>
            </div>
            
            <div class="milk-flow-footer">
              <div class="milk-flow-trend">
                <i class="fas fa-arrow-up trend-up"></i>
                <span>2% from last week</span>
              </div>
              <!-- Milk flow actions removed as requested -->
            </div>
          </div>
        </div>
      </div>
    <script>
    // Sample data
    const centers = [
      {
        name: "Main Chilling Unit",
        location: "Farm HQ",
        capacity: 5000,
        currentVolume: 4200,
        temperature: 3.5,
        status: "normal"
      },
      {
        name: "North Collection",
        location: "North Sector",
        capacity: 3000,
        currentVolume: 2950,
        temperature: 4.1,
        status: "full"
      },
      {
        name: "East Cooling",
        location: "East Village",
        capacity: 4000,
        currentVolume: 2100,
        temperature: 2.8,
        status: "low"
      },
      {
        name: "West Storage",
        location: "West Fields",
        capacity: 3500,
        currentVolume: 3200,
        temperature: 3.2,
        status: "normal"
      },
      {
        name: "South Chiller",
        location: "South District",
        capacity: 4500,
        currentVolume: 4500,
        temperature: 3.9,
        status: "full"
      }
    ];
    
    // Calculate totals
    document.getElementById('total-centers').textContent = centers.length;
    
    // Function to populate table
    function populateTable() {
      const tableBody = document.getElementById('center-table-body');
      tableBody.innerHTML = ''; // Clear existing rows
      
      centers.forEach((center, index) => {
        const utilization = Math.round((center.currentVolume / center.capacity) * 100);
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td><strong>${center.name}</strong></td>
          <td>${center.location}</td>
          <td>${center.capacity.toLocaleString()}</td>
          <td>${center.currentVolume.toLocaleString()} L (${utilization}%)</td>
          <td>${center.temperature}°C <i class="fas ${center.temperature > 4 ? 'fa-temperature-high text-danger' : 'fa-temperature-low text-primary'}"></i></td>
          <td><span class="chilling-status chilling-status-${center.status}">${
            center.status === 'full' ? 'Full' : 
            center.status === 'low' ? 'Low' : 'Normal'
          }</span></td>
          <td>
            <button class="chilling-action-btn" title="View Details"><i class="fas fa-eye"></i></button>
            <button class="chilling-action-btn" title="Edit"><i class="fas fa-edit"></i></button>
            <button class="chilling-action-btn delete-btn" title="Delete" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
          </td>
        `;
        
        tableBody.appendChild(row);
        
        // Add event listener for the view details button
        const viewBtn = row.querySelector('.chilling-action-btn[title="View Details"]');
        viewBtn.setAttribute('data-index', index);
        viewBtn.addEventListener('click', function() {
          const centerIndex = this.getAttribute('data-index');
          const center = centers[centerIndex];
          
          // Create a detailed view of the center
          const detailsHTML = `
            <h3>${center.name} - Details</h3>
            <p><strong>Location:</strong> ${center.location}</p>
            <p><strong>Capacity:</strong> ${center.capacity.toLocaleString()} L</p>
            <p><strong>Current Volume:</strong> ${center.currentVolume.toLocaleString()} L</p>
            <p><strong>Utilization:</strong> ${Math.round((center.currentVolume / center.capacity) * 100)}%</p>
            <p><strong>Temperature:</strong> ${center.temperature}°C</p>
            <p><strong>Status:</strong> ${center.status === 'full' ? 'Full' : center.status === 'low' ? 'Low' : 'Normal'}</p>
            <p><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
          `;
          
          // Display the details in an alert (could be enhanced with a modal in the future)
          alert(detailsHTML.replace(/<[^>]*>/g, ''));
        });
        
        // Add event listener for the edit button
        const editBtn = row.querySelector('.chilling-action-btn[title="Edit"]');
        editBtn.setAttribute('data-index', index);
        editBtn.addEventListener('click', function() {
          const centerIndex = this.getAttribute('data-index');
          const center = centers[centerIndex];
          
          // Populate the modal form with the center's data
          document.getElementById('centerName').value = center.name;
          document.getElementById('centerLocation').value = center.location;
          document.getElementById('centerCapacity').value = center.capacity;
          document.getElementById('currentVolume').value = center.currentVolume;
          document.getElementById('temperature').value = center.temperature;
          document.getElementById('storageStatus').value = center.status;
          
          // Update the displays
          const tempIcon = center.temperature > 4 ? 'fa-temperature-high text-danger' : 'fa-temperature-low text-primary';
          temperatureDisplay.innerHTML = `${center.temperature}°C <i class="fas ${tempIcon}"></i>`;
          
          storageStatusDisplay.className = `chilling-status chilling-status-${center.status}`;
          storageStatusDisplay.textContent = center.status === 'full' ? 'Full' : center.status === 'low' ? 'Low' : 'Normal';
          
          // Show the modal
          modal.style.display = 'block';
          
          // Store the index for later use when saving
          addCenterForm.setAttribute('data-edit-index', centerIndex);
        });
        
        // Add event listener for the delete button
        const deleteBtn = row.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', function() {
          const centerIndex = this.getAttribute('data-index');
          const centerName = centers[centerIndex].name;
          
          if (confirm(`Are you sure you want to delete "${centerName}" chilling center?`)) {
            // Remove the center from the array
            centers.splice(centerIndex, 1);
            
            // Update total centers count
            document.getElementById('total-centers').textContent = centers.length;
            
            // Refresh table
            populateTable();
          }
        });
      });
    }
    
    // Initial table population
    populateTable();
    
    // Modal functionality
    const modal = document.getElementById('addCenterModal');
    const addBtn = document.getElementById('addCenterBtn');
    const closeBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelForm');
    const addCenterForm = document.getElementById('addCenterForm');
    const capacityInput = document.getElementById('centerCapacity');
    const volumeInput = document.getElementById('currentVolume');
    const storageStatusDisplay = document.getElementById('storageStatusDisplay');
    const storageStatusInput = document.getElementById('storageStatus');
    const temperatureDisplay = document.getElementById('temperatureDisplay');
    const temperatureInput = document.getElementById('temperature');
    
    // Function to calculate storage status
    function calculateStorageStatus() {
      const capacity = parseInt(capacityInput.value) || 0;
      const volume = parseInt(volumeInput.value) || 0;
      
      if (capacity === 0) return; // Skip if capacity is not set
      
      // If volume is not set but capacity is, assume low status
      if (volume === 0) {
        storageStatusInput.value = 'low';
        storageStatusDisplay.className = 'chilling-status chilling-status-low';
        storageStatusDisplay.textContent = 'Low';
      } else {
        const utilization = (volume / capacity) * 100;
        let status = 'normal';
        let displayText = 'Normal';
        
        if (utilization < 30) {
          status = 'low';
          displayText = 'Low';
        } else if (utilization >= 90) {
          status = 'full';
          displayText = 'Full';
        }
        
        storageStatusInput.value = status;
        storageStatusDisplay.className = `chilling-status chilling-status-${status}`;
        storageStatusDisplay.textContent = displayText;
      }
      
      // Status is already set in the if-else block above
      
      // Set temperature based on capacity (just as an example)
      // Larger capacity centers might have slightly different default temperatures
      let temp = 3.5;
      if (capacity > 5000) {
        temp = 3.2;
      } else if (capacity < 2000) {
        temp = 3.8;
      }
      
      // Update temperature
      temperatureInput.value = temp;
      const tempIcon = temp > 4 ? 'fa-temperature-high text-danger' : 'fa-temperature-low text-primary';
      temperatureDisplay.innerHTML = `${temp}°C <i class="fas ${tempIcon}"></i>`;
    }
    
    // Add event listeners to update status when capacity or volume changes
    capacityInput.addEventListener('input', calculateStorageStatus);
    volumeInput.addEventListener('input', calculateStorageStatus);
    
    // Open modal for adding new center
    addBtn.addEventListener('click', () => {
      // Clear any previous edit index
      addCenterForm.removeAttribute('data-edit-index');
      
      // Set modal title for adding new center
      document.querySelector('.modal-header h3').innerHTML = '<i class="fas fa-snowflake"></i> Add New Chilling Center';
      
      // Set submit button text
      document.querySelector('.form-btn.submit').textContent = 'Add Center';
      
      // Reset form
      addCenterForm.reset();
      
      // Reset status display
      storageStatusDisplay.className = 'chilling-status chilling-status-normal';
      storageStatusDisplay.textContent = 'Normal';
      storageStatusInput.value = 'normal';
      
      // Reset temperature display
      temperatureInput.value = '3.5';
      temperatureDisplay.innerHTML = '3.5°C <i class="fas fa-temperature-low text-primary"></i>';
      
      // Show modal
      modal.style.display = 'block';
    });
    
    // Close modal
    function closeModal() {
      modal.style.display = 'none';
      addCenterForm.reset(); // Reset form fields
      // Reset status display
      storageStatusDisplay.className = 'chilling-status chilling-status-normal';
      storageStatusDisplay.textContent = 'Normal';
      storageStatusInput.value = 'normal';
      // Reset temperature display
      temperatureInput.value = '3.5';
      temperatureDisplay.innerHTML = '3.5°C <i class="fas fa-temperature-low text-primary"></i>';
    }
    
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    
    // Close modal when clicking outside
    window.addEventListener('click', (event) => {
      if (event.target === modal) {
        closeModal();
      }
    });
    
    // Form submission
    addCenterForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // Ensure capacity and volume are valid
      const capacity = parseInt(capacityInput.value) || 0;
      const volume = parseInt(volumeInput.value) || 0;
      
      if (capacity === 0) {
        alert("Please enter a valid capacity");
        capacityInput.focus();
        return;
      }
      
      // Calculate final storage status and temperature before submission
      calculateStorageStatus();
      
      // Get form values
      const centerData = {
        name: document.getElementById('centerName').value,
        location: document.getElementById('centerLocation').value,
        capacity: parseInt(document.getElementById('centerCapacity').value),
        currentVolume: parseInt(document.getElementById('currentVolume').value) || 0,
        temperature: parseFloat(document.getElementById('temperature').value),
        status: document.getElementById('storageStatus').value
      };
      
      // Check if we're editing an existing center or adding a new one
      const editIndex = addCenterForm.getAttribute('data-edit-index');
      
      if (editIndex !== null && editIndex !== undefined) {
        // Update existing center
        centers[editIndex] = centerData;
        
        // Clear the edit index
        addCenterForm.removeAttribute('data-edit-index');
        
        // Show success message
        alert(`Chilling center "${centerData.name}" has been updated successfully!`);
      } else {
        // Add new center to array
        centers.push(centerData);
        
        // Show success message
        alert(`New chilling center "${centerData.name}" has been added successfully!`);
      }
      
      // Update total centers count
      document.getElementById('total-centers').textContent = centers.length;
      
      // Refresh table
      populateTable();
      
      // Close modal
      closeModal();
    });
    
    // Milk Flow Cards Functionality
    
    // Sample data for milk flow
    const milkFlowData = {
      intake: {
        daily: [
          { date: '2023-07-01', morning: 4500, evening: 4250 },
          { date: '2023-07-02', morning: 4300, evening: 4100 },
          { date: '2023-07-03', morning: 4700, evening: 4500 },
          { date: '2023-07-04', morning: 4200, evening: 3900 },
          { date: '2023-07-05', morning: 4600, evening: 4300 },
          { date: '2023-07-06', morning: 4400, evening: 4100 },
          { date: '2023-07-07', morning: 4100, evening: 3800 }
        ],
        weekly: [
          { week: '2023-W26', total: 61200 },
          { week: '2023-W27', total: 64400 },
          { week: '2023-W28', total: 58900 },
          { week: '2023-W29', total: 62500 }
        ]
      },
      outtake: {
        daily: [
          { date: '2023-07-01', morning: 3800, evening: 3600 },
          { date: '2023-07-02', morning: 3700, evening: 3500 },
          { date: '2023-07-03', morning: 4100, evening: 3900 },
          { date: '2023-07-04', morning: 3600, evening: 3400 },
          { date: '2023-07-05', morning: 3900, evening: 3700 },
          { date: '2023-07-06', morning: 3800, evening: 3500 },
          { date: '2023-07-07', morning: 3500, evening: 3200 }
        ],
        weekly: [
          { week: '2023-W26', total: 52500 },
          { week: '2023-W27', total: 56700 },
          { week: '2023-W28', total: 51200 },
          { week: '2023-W29', total: 54300 }
        ]
      },
      processing: {
        daily: [
          { date: '2023-07-01', capacity: 75, quality: 98.2 },
          { date: '2023-07-02', capacity: 80, quality: 98.5 },
          { date: '2023-07-03', capacity: 85, quality: 99.0 },
          { date: '2023-07-04', capacity: 70, quality: 98.7 },
          { date: '2023-07-05', capacity: 75, quality: 98.9 },
          { date: '2023-07-06', capacity: 80, quality: 99.1 },
          { date: '2023-07-07', capacity: 65, quality: 98.3 }
        ],
        weekly: [
          { week: '2023-W26', avgCapacity: 72, avgQuality: 98.0 },
          { week: '2023-W27', avgCapacity: 78, avgQuality: 98.5 },
          { week: '2023-W28', avgCapacity: 70, avgQuality: 97.8 },
          { week: '2023-W29', avgCapacity: 75, avgQuality: 98.7 }
        ]
      }
    };
    
    // Set current date on cards
    function setCurrentDate() {
      const today = new Date();
      const options = { weekday: 'long', month: 'short', day: 'numeric' };
      const formattedDate = today.toLocaleDateString('en-US', options);
      
      document.getElementById('intakeDate').textContent = formattedDate;
      document.getElementById('outtakeDate').textContent = formattedDate;
      document.getElementById('processingDate').textContent = formattedDate;
    }
    
    // Calculate and display milk flow statistics
    function calculateMilkFlowStats() {
      // Get today's data (last item in the array)
      const todayIntake = milkFlowData.intake.daily[milkFlowData.intake.daily.length - 1];
      const todayOuttake = milkFlowData.outtake.daily[milkFlowData.outtake.daily.length - 1];
      const todayProcessing = milkFlowData.processing.daily[milkFlowData.processing.daily.length - 1];
      
      // Calculate today's totals
      const todayIntakeTotal = todayIntake.morning + todayIntake.evening;
      const todayOuttakeTotal = todayOuttake.morning + todayOuttake.evening;
      
      // Calculate weekly averages
      const weeklyIntakeAvg = Math.round(milkFlowData.intake.daily.reduce((sum, day) => sum + day.morning + day.evening, 0) / 7);
      const weeklyOuttakeAvg = Math.round(milkFlowData.outtake.daily.reduce((sum, day) => sum + day.morning + day.evening, 0) / 7);
      
      // Update the DOM
      document.getElementById('todayIntakeValue').textContent = todayIntakeTotal.toLocaleString() + ' L';
      document.getElementById('avgIntakeValue').textContent = weeklyIntakeAvg.toLocaleString() + ' L';
      
      document.getElementById('todayOuttakeValue').textContent = todayOuttakeTotal.toLocaleString() + ' L';
      document.getElementById('avgOuttakeValue').textContent = weeklyOuttakeAvg.toLocaleString() + ' L';
      
      document.getElementById('processingCapacityValue').textContent = todayProcessing.capacity + '%';
      document.getElementById('qualityPassValue').textContent = todayProcessing.quality + '%';
    }
    
    // Initialize milk flow cards
    function initMilkFlowCards() {
      setCurrentDate();
      calculateMilkFlowStats();
      
      // Add event listeners for the manage buttons
      document.getElementById('manageIntakeBtn').addEventListener('click', function() {
        alert('Milk Intake Management would open here');
        // In a real implementation, this would open a modal or navigate to a management page
      });
      
      document.getElementById('manageOuttakeBtn').addEventListener('click', function() {
        alert('Milk Outtake Management would open here');
        // In a real implementation, this would open a modal or navigate to a management page
      });
      
      document.getElementById('manageProcessingBtn').addEventListener('click', function() {
        alert('Milk Processing Management would open here');
        // In a real implementation, this would open a modal or navigate to a management page
      });
    }
    
    // Call the initialization function when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      initMilkFlowCards();
    });
    </script>
  </main>
  <script src="js/farm.js"></script>
</body>
</html>